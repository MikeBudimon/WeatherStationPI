<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="index.css"/>
<meta name="viewport" content="width=device-width", initial-scale=1>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<script src="http://code.highcharts.com/highcharts.js"></script>

	<title>WeatherStation Pi</title>

</head>
<body>

	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			
			<!-- Logo -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toogle="collapse" data-target="#mainNavBar">
					<span class"icon-bar"></span>
					<span class"icon-bar"></span>
					<span class"icon-bar"></span>
				</button>
				<a href="#" class="navbar-brand">WeatherStation Pi</a>
			</div>

					<!-- Menu Items -->
			<div class="collapse navbar-collapse" id="mainNavBar">
				<ul class="nav navbar-nav">
					<li class="active"><a href="">Home</a></li>
					<li><a href="">About</a></li>
					<li><a href="">Contact</a></li>
				</ul>
			</div>	
		</div>
	</nav>

<div class="container">
	<div class="page-header">
		<h1>Home Temperatures</h1>
	</div>

	<div class="panel panel-default" id= "curData">
		<p id="curTemp"></p>
		<p id="curHum"></p>
	</div>

	 <div class="btn-group btn-group-justified">
  		<div class="btn-group">
    		<button type="button" class="btn btn-warning">T: last 24h</button>
  		</div>
  		<div class="btn-group">
    		<button type="button" class="btn btn-warning">T: last Week</button>
  		</div>
  		<div class="btn-group">
    		<button type="button" class="btn btn-warning">T: last Month</button>
  		</div>
  		<div class="btn-group">
    		<button type="button" class="btn btn-warning">T: last Year</button>
  		</div>
  		<div class="btn-group">
    		<button type="button" class="btn btn-info">H: last 24h</button>
  		</div>
  		<div class="btn-group">
    		<button type="button" class="btn btn-info">H: last Week</button>
  		</div>
  		<div class="btn-group">
    		<button type="button" class="btn btn-info">H: last Month</button>
  		</div>
  		<div class="btn-group">
    		<button type="button" class="btn btn-info">H: last Year</button>
  		</div>
	</div>

<div id="container1"></div>
<div id="container2"></div>



<script type="text/javascript">
$(document).ready(function() {

	var temperature = [];
	var outsideTemp = [];
    var humidity = [];
    var outsideHum = [];
    var cputemp = [];
	var myDateFormat = "%H:%M %d.%m.%Y";


    $.getJSON("sensordata.json", function(data) {

    	$.each(data, function(i, value){

    		// to unix-timestamp
    		
    		temperature[i] = [new Date(value.Timestamp.replace(' ', 'T')+ 'Z').getTime(), parseFloat(value.Temperature)];
    		outsideTemp[i] = [new Date(value.Timestamp.replace(' ', 'T')+ 'Z').getTime(), parseFloat(value.OutsideTemp)]; 
    		humidity[i] = [new Date(value.Timestamp.replace(' ', 'T')+ 'Z').getTime(), parseFloat(value.Humidity)];
    		outsideHum[i] = [new Date(value.Timestamp.replace(' ', 'T')+ 'Z').getTime(), parseFloat(value.OutsideHum)];
    		cputemp[i] = [new Date(value.Timestamp.replace(' ', 'T')+ 'Z').getTime(), parseFloat(value.CPUTemp)];
    		
    	});

    console.log(temperature[temperature.length-1][0]);
    console.log(temperature[temperature.length-1][1]);

	document.getElementById("curTemp").innerHTML = "<b>Current Temperature:&emsp;</b>Room = <b>" + temperature[temperature.length-1][1] + " 째C</b>&emsp;Outside = <b>"+ outsideTemp[outsideTemp.length-1][1] +" 째C</b>";
	document.getElementById("curHum").innerHTML = "<b>Current Humidity:&emsp;</b>Room = <b>" + humidity[humidity.length-1][1] + " %</b>&emsp;Outside = <b>"+ outsideHum[outsideHum.length-1][1] +" %</b>";

	
    	var options1 = {
        chart: {
            renderTo: "container1",
            zoomType: "x",
        },

        title: {
        	text: "Temperature in the past 24 hours"
        },
        subtitle: {
    		text: "Click and drag in the plot area to zoom in"
		},

        yAxis: {
        	title:{
        		text: "Temperature ( 째C )"
        	},
        },
        tooltip: {
            valueSuffix: ' 째C'
            },
        xAxis: {
            type: "datetime",
            dateTimeLabelFormats: {
                millisecond: myDateFormat,
                second: myDateFormat,
                minute: myDateFormat,
                hour: myDateFormat,
                day: myDateFormat,
                week: myDateFormat,
                month: myDateFormat,
                year: myDateFormat
            },
        	min: temperature[temperature.length-1][0] - 24*3600*1000,
        	max: temperature[temperature.length-1][0]
        },

        series: []
    	};


        var options2 = {
        chart: {
            renderTo: "container2",
            zoomType: "x",
        },
        title: {
        	text: "Humidity in the past 24 hours"
        },
        yAxis: {
        	title:{
        		text: "Humidity ( % )"
        	}
        },
        tooltip: {
            valueSuffix: ' %'
            },
        xAxis: {
            type: "datetime",
            dateTimeLabelFormats: {
                millisecond: myDateFormat,
                second: myDateFormat,
                minute: myDateFormat,
                hour: myDateFormat,
                day: myDateFormat,
                week: myDateFormat,
                month: myDateFormat,
                year: myDateFormat
            },
            min: humidity[humidity.length-1][0] - 24*3600*1000,
        	max: humidity[humidity.length-1][0]
        	},

        series: []
    	};


        var chart1 = new Highcharts.Chart(options1);

        chart1.addSeries({
        	name: "Room",
        	data: temperature,
            pointInterval: 600 * 1000 // every 10 minute
        }, false);

        chart1.addSeries({
        	name: "Raspberry Pi",
        	data: cputemp,
            pointInterval: 600 * 1000
        }, false);

        chart1.addSeries({
        	name: "Outside",
        	data: outsideTemp,
        	pointInterval: 600 * 1000
        }, false);

        chart1.redraw();


        var chart2 = new Highcharts.Chart(options2);
	
        chart2.addSeries({
        	name: "Room",
        	data: humidity,
            pointInterval: 600 * 1000
        }, false);

        chart2.addSeries({
        	name: "Outside",
        	data: outsideHum,
        	pointInterval: 600 * 1000
        }, false);

        chart2.redraw();
    });

});

</script>

</div>

<nav class="navbar navbar-default navbar-fixed-bottom">
	<div class="container">
		<p class="navbar-text">Site built by Michal Wagner</p>
	</div>
</nav>

</body>
</html>